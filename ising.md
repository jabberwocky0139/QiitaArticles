<!---
	Pythonでスピンを操ろう
-->

# あらまし
以前書いた Pythonで自然発生する交通渋滞を見よう！ と似たような数理モデル一発ネタであります
今回はかなり物理寄りのお話です[^4]

# Ising模型
強磁性体を記述するモデルのひとつです. 強磁性体というのは磁石みたいな、スピンが揃っている系のことを指します. たとえば、磁石を構成する原子が持つスピンはそれ自体が小さな磁石みたいなもので、彼らの向きが揃うことでマクロな磁化(磁石の強さみたいなもの)を持つことになります. 逆に、スピンの向きがバラバラなら磁石として機能しなくなります. 

中学生くらいの頃、磁石を加熱すると金属がくっつかなくなるで！！的な実験をしたことがあるかもしれません. これは熱によって揃っていたスピンがバラけてしまい、磁化が弱まったことに依ります. この現象をPythonでシミュレートしてみましょう！

スピンと聞くと、量子論的な難しい話になるかなーと思われるかもしれませんが、解析的に扱おうとしない限りそんなに難しくないです. Ising模型自体はとても解釈しやすいシンプルな統計力学のモデルです. 

# 数学的準備: Ising模型の意味
今回は2次元Ising模型を扱います. ハミルトニアンはこんな感じ:
$$
H = -J\sum_{\langle i, j\rangle} s_i \dot s_j}
$$

$\langle i, j\rangle$ は隣接サイトのスピンを表します. 相互作用するのは隣同士のスピンだけです. $J$は相互作用定数で、スピン間の相互作用の大きさを表します. $s_i, s_j$ がスピンで、アップスピンを1, ダウンスピンを-1とします. 

ハミルトニアンは系の内部エネルギーを表しているので、上の式が言っていることは、「スピンが揃っている(スピンの積が正)と内部エネルギーは小さくなる」「スピンがばらついている(スピンの積が負)と内部エネルギーは大きくなる」ということです. 

このモデルを磁化のはなしに繋げるために、ヘルムホルツ自由エネルギーの定義を引っ張ってきましょう:
$$
F = U - TS
$$

熱力学を思い出してください. 系の平衡状態はヘルムホルツエネルギーが最小になるように選ばれます. 上の式を見ると、例えば、高温($TS > U$)では$F$を小さくするために、エントロピー$S$が大きくなります. つまり、スピンがばらけるわけです. 一方、低温($TS > U$)では内部エネルギー$U = \langle H \rangle$が小さくなります. これはスピンが揃っていることに対応しますね. 

熱力学の定義に当てはめて、磁石の現象を再現する最もシンプルなモデルがIsing模型です. 


# 数学的準備: コーディングに向けて
**(※注) かなり統計力学に首を突っ込んだ話になります. アルゴリズムだけをかいつまみたい方は、以下の議論をふっ飛ばして結論に飛んで頂いてOKです**

さて、Ising模型の概要がなんとなくわかったところで、解析的な話を大方ぶっとばしてコーディングの準備に入ります. 今回興味があるのは以下の2点です:

1. 適当なスピンマップを持ってきて、温度を下げていくと磁区(スピンが揃っている領域)が自発的に形成されること  
2. 磁区が形成されている状態から温度を上げていくとスピンがバラけていくこと

ここで考えなければならないことがあります. ヘルムホルツエネルギーが内部エネルギーに強く依存するような低温下ではスピンが揃っていきますが、ただ$F$を小さくするようにスピンをフリップさせるコードを書くと全スピンが単一方向を向くことになります[^1]. まあ絶対零度ならそれでもいいかな、、、とは思いますが、そこから少しずつ温度を上げていくとエントロピーの寄与が効いてきて、スピンの向きが次第にバラけていきます. この「温度によるバラけ」はどのようにして実現されるべきでしょうか？

実現される「べき」と書いたのは、物理を無視すれば温度によるバラけを表すモデルをつくることはいくらでもできるからです. 今回はIsingモデルからスタートして物理で議論を展開してきているので、温度によるバラけ方も物理に紐付いた形でなければなりません. これを統計力学から探っていきましょう. 

そもそも平衡状態ってなに？から考えましょう. 統計力学でいうところは平衡は、系のエネルギーがBoltzmann分布に従うことです. 系にたくさんある各スピンは、ハミルトニアンの定義に従って内部エネルギーを持ちます($-J s_i \dot s_j$). 「適当なスピンマップを持ってきて、、、」のくだりが意味するところは、系のエネルギーがめちゃくちゃな分布であるような状態から、スピンをフリップさせてBoltzmann分布に持っていこう！ということです. 

仮に系のエネルギーがBoltzmann分布にたどり着いたとして、それ以降はスピンが全く動かないかといったら、そんなことはないです. エネルギーが大きくなるような遷移と小さくなるような遷移が等確率で起きているのが自然です[^2]. これを表すのが以下の式です:
$$
W(E, E')P(E') = W(E', E)P(E)
$$

$P(E)$ が内部エネルギーの分布、$W(E, E')$をエネルギー$E' \rigitarrow E$へと遷移する確率です. つまり$W(E, E')P(E')$はエネルギー$E' \rigitarrow E$へと遷移する流れと解釈でき、順方向と逆方向の流れの強さが等しければ平衡、ということを意味しています[^3]. ここでエネルギー分布$P(E)$の具体系はカノニカル分布の定義により
$$
P(E) = \frac{e^{\beta E}}{Z}
$$

となります. $Z$は分配関数、$\beta = \frac{1}{kT}$は逆温度です. これを先ほどの流れの式に代入すると
$$
e^{-\beta(E - E')} = \frac{W(E, E')}{W(E', E)}
$$

これを満たすようなWとして
$$
W(E, E') = \begin{cases}
1 & (E \leq E') \\
e^{-\beta(E - E')} & (E \geq E')
\end{cases}
$$

を与えることにします. 

長くなりましたが、上の条件を満たすようにスピンをフリップしていくことになります:

1. スピンをフリップしたときに、エネルギー的に安定する(低くなる)ならばそのままにする
2. スピンをフリップしたときに、エネルギー的に不安定(高くなる)ならば、確率$e^{-\beta(E - E')}$ で反転を許可する

このアルゴリズムをMetropolis法と呼びます. これに従ってスピンをフリップしていくと、エネルギーの分布はボルツマン分布に近づいていくことになります. 

# おまけ
**(※注) これもスルーしていただいてOKです**

分配関数の具体系は
$$
Z(\omega) = \sum_\omega e^{-beta E(\omega)}
$$

です. $\omega$ は微視的状態を指します. 今回の例で言えば、スピンの配列が微視的状態にあたります. 分配関数は全ての微視的状態についてのアンサンブルの和です. 詳細は省きますが、分配関数には内部エネルギー$E$が含まれるため、これをハミルトニアンを用いて記述することができます. つまり、$Z$には系の情報が全て含まれていることになります. それに加えて、分配関数には温度(\beta = \frac{1}{kT})が含まれているため、系に温度の情報を付加したことになります. 量子論において有限温度系を扱う場合は、ハミルトニアンを直接弄るのではなく、分配関数を扱っていくことになります. これが量子統計力学です. 

先程のメトロポリス法にはヘルムホルツエネルギーを最小にする、という文脈は現れていませんでした. なぜかというと、その情報は分配関数に既に含まれているからです. ハミルトニアンには温度の情報が含まれていないため、最初はIsingモデルとヘルムホルツエネルギーを別々のものとして扱いましたが、分配関数によってそれらをまとめて取り扱えるのです. まさに量子論と熱学の融合！この万能感よ、、、

そもそもの話のスタートは微視的状態であり、今回の例に当てはめればそれはスピンの配列です. そのミクロな情報からマクロな法則を導くのが統計力学です. 大量にあるスピンをひとつひとつシュレディンガー方程式で扱っていくとキリがないので、その全体の振る舞いを調べるためにとても有用な学問です. 分配関数からヘルムホルツエネルギーや内部エネルギーを導出することができることからわかるように、ミクロな情報からスタートし、最終的に熱力学を再現できたことになるのです. 

熱力学はそれ自体閉じた学問体型ですが、熱力学が謳う法則をよりミクロなレベルから導出した天才がボルツマンです. 

とても良くできていて面白い学問なので、気になった方は是非勉強してみてください. 

# コーディング
では、メトロポリス法を実装していきましょう




# おまけのおまけ
ちなみに、、、

1次元Ising模型を解析的に解くことは、統計力学がわかっていればそんなに難しくありません. では、今回扱ったような2次元のIsing模型はどうかと言うと、かなーり厄介です. その昔、Onsagerが厳密解を求めましたが、数学的にかなりスパルタンだったようです. Onsagerは熱力学関連の業績でもってノーベル賞を受賞しています. 

一方で、我らが南部陽一郎先生も2次元Ising模型の厳密解をOnsagerとは別の解法で求めています. 南部先生もまた、自発的対称性の破れに関する研究でノーベル賞を受賞しています. 

ずいぶんとシンプルなモデルですが、それ故に熱学・統計力学の発展にはなくてはならないモデルであり、その研究には弩級の天才たちの影があります.



[^4]: 物理にお詳しい方から見ると議論に粗が見えるかもしれません. ご容赦
[^1]: 正確には、初期状態にかなり依存はします. 完全に同一方向に向くようなコードを書くためには少し工夫が必要です
[^2]: 化学平衡の定義はまさにこれです. 順反応と逆反応が同じ頻度で起きているわけです
[^3]: この関係の元になっているのはMaster方程式と呼ばれる時間発展方程式です. 今回の系の時間発展はMaster方程式で記述できるものと仮定しています. 


